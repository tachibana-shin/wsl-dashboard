import { Theme, AppI18n } from "../theme.slint";
import { SidebarItem } from "common.slint";

export component Sidebar inherits Rectangle {
    in-out property <bool> collapsed: false;
    in property <int> selected_tab: 0;
    
    // Callbacks to bubble up
    callback tab_selected(int);
    width: collapsed ? 54px : 200px;
    background: Theme.sidebar_bg;
    animate width {
        duration: 200ms;
        easing: ease-out-quad;
    }
    VerticalLayout {
        padding-left: 4px;
        padding-right: 4px;
        padding-top: 12px;
        padding-bottom: 16px;
        spacing: 4px;
        alignment: start;

        // Space for floating logo
        Rectangle {
            height: 4px;
        }

        // Hamburger menu button
        Rectangle {
            height: 36px;
            border-radius: 4px;
            background: touch_menu.has-hover ? Theme.hover_bg : transparent;
            HorizontalLayout {
                padding-left: 13px;
                alignment: start;
                Text {
                    text: "\u{E700}";
                    font-size: 16px;
                    font-family: Theme.icon_font;
                    color: touch_menu.has-hover ? Theme.accent : Theme.text_secondary;
                    vertical-alignment: center;
                    horizontal-alignment: center;
                    width: 20px;
                }
            }

            touch_menu := TouchArea {
                clicked => {
                    root.collapsed = !root.collapsed;
                }
            }
        }

        SidebarItem {
            icon: "\u{E80F}";
            text: AppI18n.t("sidebar.home", [AppI18n.version]);
            selected: selected_tab == 0;
            collapsed: root.collapsed;
            clicked => {
                root.tab_selected(0);
            }
        }

        SidebarItem {
            icon: "\u{E710}";
            text: AppI18n.t("sidebar.add", [AppI18n.version]);
            selected: selected_tab == 1;
            collapsed: root.collapsed;
            clicked => {
                root.tab_selected(1);
            }
        }

        Rectangle {
            vertical-stretch: 1;
        } // Spacer
        
        Rectangle {
            height: 8px;
        }

        Rectangle {
            x: 4px;
            width: parent.width - 8px;
            height: 1px;
            background: Theme.border_color;
        }

        SidebarItem {
            icon: "\u{E713}";
            text: AppI18n.t("sidebar.settings", [AppI18n.version]);
            selected: selected_tab == 5;
            collapsed: root.collapsed;
            clicked => {
                root.tab_selected(5);
            }
        }

        SidebarItem {
            icon: "\u{E946}";
            text: AppI18n.t("sidebar.about", [AppI18n.version]);
            selected: selected_tab == 6;
            collapsed: root.collapsed;
            clicked => {
                root.tab_selected(6);
            }
        }
    }

    // Logo - Absolute positioned
    Rectangle {
        x: 19px;
        y: -28px;
        width: 16px;
        height: 16px;
        Image {
            source: @image-url("../../../assets/logo/mini.png");
            width: 100%;
            height: 100%;
            image-fit: contain;
        }
    }
}
