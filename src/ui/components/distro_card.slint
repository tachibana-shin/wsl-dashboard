import { Theme, Distro, AppI18n } from "../theme.slint";
import { ActionIcon } from "common.slint";

export component DistroCard inherits Rectangle {
    in property <bool> show_information: false;
    in-out property <bool> show_settings: false;
    in property <bool> show_rootfs_help: false;
    in property <Distro> distro;
    in-out property <bool> expanded: false;
    in property <bool> sole_distro: false;
    callback start_clicked;
    callback stop_clicked;
    callback restart_clicked;
    callback terminal_clicked;
    callback folder_clicked;
    callback vscode_clicked;
    callback export_clicked;
    callback settings_clicked;
    callback delete_clicked;
    callback edit_bashrc_clicked;
    callback clone_clicked;
    callback move_clicked;
    callback information_clicked;
    height: expanded ? 96px : 48px;
    background: (distro.is_default && !sole_distro) ? (Theme.dark_mode ? #2b3c4e : #e6f4ff98) : Theme.card_bg;
    border-radius: 6px;
    border-width: 1px;
    border-color: Theme.border_color;
    animate height {
        duration: 200ms;
        easing: ease-out-quad;
    }
    property <bool> is_icon_hovered: icon_touch.has-hover;
    VerticalLayout {
        padding: 0px;
        HorizontalLayout {
            height: 48px;
            padding-left: 12px;
            padding-right: 8px;
            spacing: 0px;
            alignment: space-between;
            HorizontalLayout {
                spacing: 8px;
                alignment: start;
                ActionIcon {
                    y: (parent.height - 28px) / 2;
                    icon: (distro.status == "Running") ? "\u{E769}" : "\u{E768}";
                    is_font_icon: true;
                    tooltip: (distro.status == "Running") ? AppI18n.t("distro.stop", [AppI18n.version]) : AppI18n.t("distro.start", [AppI18n.version]);
                    clicked => {
                        if (distro.status == "Running") {
                            root.stop_clicked();
                        } else {
                            root.start_clicked();
                        }
                    }
                }

                Rectangle {
                    width: 28px;
                    height: 48px;
                    background: transparent;
                    icon_touch := TouchArea {
                        width: 28px;
                        height: 28px;
                        y: (parent.height - self.height) / 2;
                    }

                    if (distro.has_icon): Rectangle {
                        width: 28px;
                        height: 28px;
                        background: transparent;
                        y: (parent.height - self.height) / 2;
                        Image {
                            width: 22px;
                            height: 22px;
                            x: (parent.width - self.width) / 2;
                            y: (parent.height - self.height) / 2;
                            source: distro.icon;
                            image-fit: contain;
                        }
                    }
                    if (!distro.has_icon): Rectangle {
                        width: 28px;
                        height: 28px;
                        background: #0078D4;
                        border-radius: 4px;
                        y: (parent.height - self.height) / 2;
                        Text {
                            text: distro.initial;
                            color: white;
                            font-size: 16px;
                            font-weight: 500;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                            overflow: elide;
                        }
                    }
                }

                VerticalLayout {
                    alignment: center;
                    spacing: 0px;
                    y: (parent.height - self.height) / 2;
                    Text {
                        text: distro.name;
                        font-size: 14px;
                        font-family: Theme.default_font;
                        font-weight: 600;
                        color: Theme.text_primary;
                    }

                    Text {
                        text: (distro.status == "Running") ? AppI18n.t("distro.running", [AppI18n.version]) : AppI18n.t("distro.stopped", [AppI18n.version]);
                        font-size: 11px;
                        color: Theme.text_secondary;
                    }
                }
            }

            HorizontalLayout {
                spacing: 8px;
                alignment: end;
                HorizontalLayout {
                    spacing: 4px;
                    y: (parent.height - 28px) / 2;
                    ActionIcon {
                        icon: "\u{E756}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.terminal", [AppI18n.version]);
                        clicked => {
                            root.terminal_clicked();
                        }
                    }

                    ActionIcon {
                        icon: "\u{E70B}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.vscode", [AppI18n.version]);
                        clicked => {
                            root.vscode_clicked();
                        }
                    }

                    ActionIcon {
                        icon: "\u{E8B7}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.explorer", [AppI18n.version]);
                        clicked => {
                            root.folder_clicked();
                        }
                    }
                }

                ActionIcon {
                    y: (parent.height - self.height) / 2;
                    icon: expanded ? "\u{E70E}" : "\u{E70D}";
                    is_font_icon: true;
                    tooltip: expanded ? AppI18n.t("distro.collapse", [AppI18n.version]) : AppI18n.t("distro.expand", [AppI18n.version]);
                    clicked => {
                        root.expanded = !root.expanded;
                    }
                }
            }
        }

        if (expanded): Rectangle {
            background: transparent;
            height: 48px;
            clip: true;
            Rectangle {
                y: -1px;
                width: parent.width;
                height: parent.height + 1px;
                background: Theme.dark_mode ? #252526 : #F9FAFB;
                border-bottom-left-radius: 6px;
                border-bottom-right-radius: 6px;
                border-width: 1px;
                border-color: Theme.border_color;
                HorizontalLayout {
                    padding-left: 12px;
                    padding-right: 12px;
                    spacing: 12px;
                    alignment: end;
                    ActionIcon {
                        y: (parent.height - self.height) / 2;
                        icon: "\u{E7B3}"; // Hard Drive icon (Legacy)
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.information", [AppI18n.version]);
                        clicked => {
                            root.information_clicked();
                        }
                    }

                    ActionIcon {
                        y: (parent.height - self.height) / 2;
                        icon: "\u{E777}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.restart", [AppI18n.version]);
                        clicked => {
                            root.restart_clicked();
                        }
                    }

                    ActionIcon {
                        y: (parent.height - self.height) / 2;
                        icon: "\u{EDE1}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.export", [AppI18n.version]);
                        clicked => {
                            root.export_clicked();
                        }
                    }

                    ActionIcon {
                        y: (parent.height - self.height) / 2;
                        icon: "\u{E8DE}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.move", [AppI18n.version]);
                        clicked => {
                            root.move_clicked();
                        }
                    }

                    ActionIcon {
                        y: (parent.height - self.height) / 2;
                        icon: "\u{E8C8}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.clone", [AppI18n.version]);
                        clicked => {
                            root.clone_clicked();
                        }
                    }

                    ActionIcon {
                        y: (parent.height - self.height) / 2;
                        icon: "\u{E74D}";
                        is_font_icon: true;
                        tooltip: AppI18n.t("distro.delete", [AppI18n.version]);
                        clicked => {
                            root.delete_clicked();
                        }
                    }

                    ActionIcon {
                        y: (parent.height - self.height) / 2;
                        icon: "\u{E713}"; // Settings icon
                        is_font_icon: true;
                        tooltip: AppI18n.t("sidebar.settings", [AppI18n.version]);
                        clicked => {
                            root.settings_clicked();
                        }
                    }
                }
            }
        }
    }

    if (is_icon_hovered && distro.distro_display_name != ""): Rectangle {
        z: 1000;
        x: 44px;
        y: (48px - self.height) / 2;
        width: tooltip_text.preferred-width + 16px;
        height: 28px;
        border-radius: 6px;
        border-width: 1px;
        background: Theme.dark_mode ? #2D2D30 : #FFFFFF;
        border-color: Theme.border_color;
        tooltip_text := Text {
            text: distro.distro_display_name;
            color: Theme.text_primary;
            font-size: 12px;
            font-weight: 500;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
    }
}
