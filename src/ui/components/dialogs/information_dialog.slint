import { Theme, Information, AppI18n } from "../../theme.slint";

component InfoRow inherits HorizontalLayout {
    in property <string> label;
    in property <string> value;
    in property <color> value_color: Theme.text_primary;
    in property <bool> clickable: false;
    callback clicked;
    spacing: 12px;
    alignment: start;
    Text {
        text: root.label;
        width: 100px;
        color: Theme.text_secondary;
        font-size: 13px;
        vertical-alignment: center;
    }

    if (root.clickable): touch_area := TouchArea {
        mouse-cursor: pointer;
        clicked => {
            root.clicked();
        }
        horizontal-stretch: 1;
        Rectangle {
            background: touch_area.has-hover ? (Theme.dark_mode ? #2D2D30 : #F0F0F0) : transparent;
            border-radius: 4px;
            Text {
                text: root.value;
                color: touch_area.has-hover ? Theme.accent : root.value_color;
                font-size: 13px;
                font-weight: 500;
                vertical-alignment: center;
                overflow: elide;
                width: 100%;
            }
        }
    }
    if (!root.clickable): Text {
        text: root.value;
        color: root.value_color;
        font-size: 13px;
        font-weight: 500;
        vertical-alignment: center;
        overflow: elide;
        horizontal-stretch: 1;
    }
}

export component InformationDialog inherits Rectangle {
    in property <Information> info;
    callback close;
    callback open_path(string);
    
    // Background mask
    background: #00000080;
    
    // Close on mask click
    TouchArea {
        clicked => {
            root.close();
        }
    }

    // Dialog Box
    Rectangle {
        width: 440px;
        height: 260px;
        background: Theme.card_bg;
        border-radius: 8px;
        border-width: 1px;
        border-color: Theme.border_color;
        TouchArea { /* prevent click through */ }

        VerticalLayout {
            padding: 24px;
            spacing: 12px; // Reduced spacing slightly
            
            // Header
            HorizontalLayout {
                alignment: space-between;
                Text {
                    text: AppI18n.t("dialog.info_title", [root.info.distro_name, AppI18n.version]);
                    font-size: 18px;
                    font-weight: 500;
                    color: Theme.text_primary;
                }

                TouchArea {
                    width: 24px;
                    height: 24px;
                    clicked => {
                        root.close();
                    }
                    Rectangle {
                        background: parent.has-hover ? Theme.hover_bg : transparent;
                        border-radius: 4px;
                        Text {
                            text: "\u{E8BB}";
                            font-family: Theme.icon_font;
                            font-size: 14px;
                            color: Theme.text_primary;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                }
            }

            Rectangle {
                height: 1px;
                background: Theme.border_color;
            }

            // Content
            VerticalLayout {
                spacing: 10px;
                alignment: start;
                InfoRow {
                    label: AppI18n.t("dialog.wsl_version", [AppI18n.version]);
                    value: root.info.wsl_version;
                }

                InfoRow {
                    label: AppI18n.t("dialog.state", [AppI18n.version]);
                    value: (root.info.status == "Running") ? AppI18n.t("distro.running", [AppI18n.version]) : AppI18n.t("distro.stopped", [AppI18n.version]);
                    value_color: root.info.status == "Running" ? #28a745 : Theme.text_primary;
                }

                // Internal Usage (Pill style)
                HorizontalLayout {
                    spacing: 12px;
                    alignment: start;
                    Text {
                        text: AppI18n.t("dialog.internal_usage", [AppI18n.version]);
                        width: 100px;
                        color: Theme.text_secondary;
                        font-size: 13px;
                        vertical-alignment: center;
                    }

                    Rectangle {
                        background: Theme.dark_mode ? #1E1E1E : #F3F3F3;
                        border-radius: 4px;
                        HorizontalLayout {
                            padding-left: 8px;
                            padding-right: 8px;
                            padding-top: 4px;
                            padding-bottom: 4px;
                            alignment: center; // Fix vertical centering
                            Text {
                                text: root.info.actual_used;
                                color: Theme.accent;
                                font-family: "Consolas";
                                font-size: 13px;
                                font-weight: 500;
                                vertical-alignment: center;
                            }
                        }
                    }
                }
                
                // VHDX Size (Pill style match)
                HorizontalLayout {
                    spacing: 12px;
                    alignment: start;
                    Text {
                        text: AppI18n.t("dialog.vhdx_usage", [AppI18n.version]);
                        width: 100px;
                        color: Theme.text_secondary;
                        font-size: 13px;
                        vertical-alignment: center;
                    }

                    Rectangle {
                        background: Theme.dark_mode ? #1E1E1E : #F3F3F3;
                        border-radius: 4px;
                        HorizontalLayout {
                            padding-left: 8px;
                            padding-right: 8px;
                            padding-top: 4px;
                            padding-bottom: 4px;
                            alignment: center; // Fix vertical centering
                            Text {
                                text: root.info.vhdx_size;
                                color: Theme.accent;
                                font-family: "Consolas"; // Match font
                                font-size: 13px;
                                font-weight: 500;
                                vertical-alignment: center;
                            }
                        }
                    }
                }

                InfoRow {
                    label: AppI18n.t("dialog.vhdx_location", [AppI18n.version]);
                    value: root.info.vhdx_path;
                    clickable: true;
                    clicked => {
                        root.open_path(root.info.install_location);
                    }
                }
            }

            // Footer
            HorizontalLayout {
                alignment: end;
                padding-top: 0px; // Reduce whitespace
                Rectangle {
                    width: 90px;
                    height: 32px;
                    background: Theme.accent;
                    border-radius: 6px;
                    Text {
                        text: AppI18n.t("dialog.confirm", [AppI18n.version]);
                        color: white;
                        font-size: 13px;
                        font-weight: 500;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }

                    TouchArea {
                        clicked => {
                            root.close();
                        }
                    }
                }
            }
        }
    }
}
