import {
    Theme,
    Information,
    AppI18n,
    LayoutConstants,
} from "../../theme.slint";

component InfoRow inherits Rectangle {
    in property <string> label;
    in property <string> value;
    in property <color> value_color: Theme.text_primary;
    in property <bool> clickable: false;
    in property <bool> is_pill: false;
    callback clicked;
    height: 24px;
    Text {
        x: AppI18n.is-rtl ? parent.width - self.width : 0;
        text: root.label + ":" + (AppI18n.is-rtl ? "\u{200F}" : "");
        width: 110px;
        color: Theme.text_secondary;
        font-size: 13px * LayoutConstants.font-scale;
        font-family: Theme.default_font;
        vertical-alignment: center;
        horizontal-alignment: AppI18n.is-rtl ? right : left;
    }

    if (!is_pill): touch_area := TouchArea {
        x: AppI18n.is-rtl ? 0 : 122px;
        width: parent.width - 122px;
        mouse-cursor: root.clickable ? pointer : default;
        clicked => {
            if (root.clickable) {
                root.clicked();
            }
        }
        Rectangle {
            background: (root.clickable && touch_area.has-hover) ? (Theme.dark_mode ? #2D2D30 : #F0F0F0) : transparent;
            border-radius: 4px;
            Text {
                text: root.value;
                color: (root.clickable && touch_area.has-hover) ? Theme.accent : root.value_color;
                font-size: 13px * LayoutConstants.font-scale;
                font-family: Theme.default_font;
                font-weight: 500;
                vertical-alignment: center;
                horizontal-alignment: AppI18n.is-rtl ? left : left; // Keep values left-aligned for consistency
                overflow: elide;
                width: 100%;
            }
        }
    }
    if (is_pill): Rectangle {
        x: AppI18n.is-rtl ? 0 : 122px;
        width: pill_text.width + 16px;
        height: 20px;
        y: (parent.height - self.height) / 2;
        background: Theme.dark_mode ? #1E1E1E : #F3F3F3;
        border-radius: 4px;
        pill_text := Text {
            text: root.value;
            color: Theme.accent;
            font-family: Theme.default_font;
            font-size: 12px * LayoutConstants.font-scale;
            font-weight: 500;
            vertical-alignment: center;
            horizontal-alignment: center;
        }
    }
}

export component InformationDialog inherits Rectangle {
    in property <Information> info;
    callback close;
    callback open_path(string);
    
    // Background mask
    background: #00000080;
    
    // Close on mask click
    TouchArea {
        clicked => {
            root.close();
        }
    }

    // Dialog Box
    Rectangle {
        width: 440px;
        height: 285px;
        background: Theme.card_bg;
        border-radius: 8px;
        border-width: 1px;
        border-color: Theme.border_color;
        TouchArea { /* prevent click through */ }

        VerticalLayout {
            padding: 24px;
            spacing: 12px;
            
            // Header
            Rectangle {
                height: 24px;
                Text {
                    x: AppI18n.is-rtl ? 32px : 0;
                    width: parent.width - 32px;
                    text: AppI18n.t("dialog.info_title", [root.info.distro_name, AppI18n.version]);
                    font-size: 18px * LayoutConstants.font-scale;
                    font-family: Theme.default_font;
                    font-weight: 500;
                    color: Theme.text_primary;
                    horizontal-alignment: AppI18n.is-rtl ? right : left;
                    vertical-alignment: center;
                }

                TouchArea {
                    x: AppI18n.is-rtl ? 0 : parent.width - self.width;
                    width: 24px;
                    height: 24px;
                    clicked => {
                        root.close();
                    }
                    Rectangle {
                        background: parent.has-hover ? Theme.hover_bg : transparent;
                        border-radius: 4px;
                        Text {
                            text: "\u{E8BB}";
                            font-family: Theme.icon_font;
                            font-size: 14px;
                            color: Theme.text_primary;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                }
            }

            Rectangle {
                height: 1px;
                background: Theme.border_color;
            }

            // Content
            VerticalLayout {
                spacing: 8px;
                alignment: start;
                InfoRow {
                    label: AppI18n.t("dialog.wsl_version", [AppI18n.version]);
                    value: root.info.wsl_version;
                }

                InfoRow {
                    label: AppI18n.t("dialog.state", [AppI18n.version]);
                    value: (root.info.status == "Running") ? AppI18n.t("distro.running", [AppI18n.version]) : AppI18n.t("distro.stopped", [AppI18n.version]);
                    value_color: root.info.status == "Running" ? #28a745 : Theme.text_primary;
                }

                InfoRow {
                    label: AppI18n.t("dialog.internal_usage", [AppI18n.version]);
                    value: root.info.actual_used;
                    is_pill: true;
                }

                InfoRow {
                    label: AppI18n.t("dialog.vhdx_usage", [AppI18n.version]);
                    value: root.info.vhdx_size;
                    is_pill: true;
                }

                InfoRow {
                    label: AppI18n.t("dialog.vhdx_location", [AppI18n.version]);
                    value: root.info.vhdx_path;
                    clickable: true;
                    clicked => {
                        root.open_path(root.info.install_location);
                    }
                }
            }

            // Footer
            HorizontalLayout {
                alignment: AppI18n.is-rtl ? start : end;
                Rectangle {
                    width: 90px;
                    height: 32px;
                    background: Theme.accent;
                    border-radius: 6px;
                    Text {
                        text: AppI18n.t("dialog.confirm", [AppI18n.version]);
                        color: white;
                        font-size: 13px * LayoutConstants.font-scale;
                        font-family: Theme.default_font;
                        font-weight: 500;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }

                    TouchArea {
                        clicked => {
                            root.close();
                        }
                    }
                }
            }
        }
    }
}
