import { Theme, AppI18n, LayoutConstants } from "../../theme.slint";
import { CustomButton, CustomLineEdit } from "../form_widgets.slint";

export component CloneDialog inherits Rectangle {
    in property <string> distro_name;
    in-out property <string> clone_name;
    in-out property <string> clone_path;
    in property <string> error_msg;
    callback confirm(string, string);
    callback cancel();
    callback browse();
    callback name_changed(string);
    in property <bool> enabled: true;
    background: #00000080;
    TouchArea { }

    Rectangle {
        width: 450px;
        height: 320px;
        background: Theme.card_bg;
        border-radius: 8px;
        border-width: 1px;
        border-color: Theme.border_color;
        drop-shadow-blur: 16px;
        drop-shadow-color: #00000040;
        VerticalLayout {
            padding: 24px;
            spacing: 16px;
            Text {
                text: AppI18n.t("dialog.clone_title", [AppI18n.version]) + ": " + distro_name;
                font-size: 18px * LayoutConstants.font-scale;
                font-family: Theme.default_font;
                font-weight: 500;
                color: Theme.text_primary;
                horizontal-alignment: AppI18n.is-rtl ? right : left;
            }

            VerticalLayout {
                spacing: 8px;
                Text {
                    text: AppI18n.t("dialog.new_name", [AppI18n.version]) + ":";
                    font-size: 13px * LayoutConstants.font-scale;
                    font-family: Theme.default_font;
                    color: Theme.text_secondary;
                    horizontal-alignment: AppI18n.is-rtl ? right : left;
                }

                CustomLineEdit {
                    text <=> clone_name;
                    placeholder-text: AppI18n.t("add.placeholder_instance_name", [AppI18n.version]);
                    height: 32px;
                    enabled: root.enabled;
                    edited(text) => {
                        root.name_changed(text);
                    }
                }
            }

            VerticalLayout {
                spacing: 8px;
                Text {
                    text: AppI18n.t("dialog.target_path", [AppI18n.version]) + ":";
                    font-size: 13px * LayoutConstants.font-scale;
                    font-family: Theme.default_font;
                    color: Theme.text_secondary;
                    horizontal-alignment: AppI18n.is-rtl ? right : left;
                }

                HorizontalLayout {
                    spacing: 8px;
                    if (!AppI18n.is-rtl): CustomLineEdit {
                        text <=> clone_path;
                        enabled: false;
                        height: 32px;
                        horizontal-stretch: 1;
                    }
                    CustomButton {
                        text: AppI18n.t("settings.select_folder", [AppI18n.version]);
                        height: 32px;
                        enabled: root.enabled;
                        clicked => {
                            root.browse();
                        }
                    }

                    if (AppI18n.is-rtl): CustomLineEdit {
                        text <=> clone_path;
                        enabled: false;
                        height: 32px;
                        horizontal-stretch: 1;
                    }
                }
            }

            if (error_msg != ""): Text {
                text: error_msg;
                color: #ff3333;
                font-size: 12px * LayoutConstants.font-scale;
                font-family: Theme.default_font;
                wrap: word-wrap;
                horizontal-alignment: AppI18n.is-rtl ? right : left;
            }
            Rectangle {
                vertical-stretch: 1;
            } // Spacer

            HorizontalLayout {
                alignment: AppI18n.is-rtl ? start : end;
                spacing: 12px;
                if (AppI18n.is-rtl): CustomButton {
                    text: AppI18n.t("distro.clone", [AppI18n.version]);
                    height: 32px;
                    primary: true;
                    enabled: root.enabled;
                    clicked => {
                        root.confirm(clone_name, clone_path);
                    }
                }
                CustomButton {
                    text: AppI18n.t("dialog.cancel", [AppI18n.version]);
                    height: 32px;
                    clicked => {
                        root.cancel();
                    }
                }

                if (!AppI18n.is-rtl): CustomButton {
                    text: AppI18n.t("distro.clone", [AppI18n.version]);
                    height: 32px;
                    primary: true;
                    enabled: root.enabled;
                    clicked => {
                        root.confirm(clone_name, clone_path);
                    }
                }
            }
        }
    }
}
