import {
    ConfirmationDialog,
    ExportDialog,
    CloneDialog,
    MoveDialog,
    MessageDialog,
    CheckUpdateDialog,
    StoreInstallWarnDialog,
    InformationDialog,
    SettingsDialog,
    RootFSHelpDialog,
    VSCodeStartupDialog,
} from "dialogs.slint";
import { AppInfo, Information, RootFSHelpItem, AppI18n } from "../theme.slint";

export component ModalManager inherits Rectangle {
    // Controls
    in property <bool> show_delete: false;
    in property <bool> show_export: false;
    in property <bool> show_clone: false;
    in property <bool> show_move: false;
    in property <bool> show_move_confirm: false;
    in property <bool> show_message: false;
    in property <bool> show_update: false;
    in property <bool> show_install_warn: false;
    in property <bool> show_expire: false;
    in property <bool> show_information: false;
    in-out property <bool> show_settings: false;
    in property <bool> show_rootfs_help: false;
    in property <bool> show_vscode_startup: false;
    in property <bool> is_installing: false;

    // Data
    in property <string> delete_target_name: "";
    in property <string> export_target_name: "";
    in-out property <string> export_path;
    in property <string> export_error: "";
    in property <string> clone_source_name: "";
    in-out property <string> clone_target_name;
    in-out property <string> clone_target_path;
    in property <string> clone_error: "";
    in property <string> move_source_name: "";
    in-out property <string> move_target_name;
    in-out property <string> move_target_path;
    in property <string> move_error: "";
    in property <string> move_confirm_message: "";
    in property <string> message_text;
    in property <string> message_link_text: "";
    in property <string> message_action_text: "";
    in property <string> settings_target_name: "";
    in-out property <string> settings_terminal_dir: "~";
    in-out property <string> settings_vscode_dir: "/home";
    in-out property <bool> settings_is_default: false;
    in-out property <bool> settings_lock_default: false;
    in-out property <bool> settings_autostart: false;
    in-out property <string> settings_startup_script: "";
    in property <string> settings_terminal_dir_error: "";
    in property <string> settings_vscode_dir_error: "";
    in property <string> settings_startup_script_error: "";
    in property <string> settings_default_error: "";
    in property <Information> information;
    in property <[RootFSHelpItem]> rootfs_help_list;

    // Callbacks
    callback confirm_delete();
    callback cancel_delete();
    callback confirm_export(string);
    callback cancel_export();
    callback browse_export();
    callback confirm_clone(string, string);
    callback cancel_clone();
    callback browse_clone();
    callback confirm_move(string);
    callback cancel_move();
    callback browse_move();
    callback confirm_move_action();
    callback cancel_move_confirm();
    callback close_message();
    callback message_link_clicked();
    callback message_action_clicked();
    callback clone_name_changed(string);
    callback download_update();
    callback close_update();
    callback confirm_install_warn();
    callback cancel_install_warn();
    callback close_expire();
    callback close_information();
    callback confirm_settings(string, string, string, bool, bool, string);
    callback close_settings();
    callback close_rootfs_help();
    callback close_vscode_startup();
    callback open_url(string);
    if (show_delete): ConfirmationDialog {
        width: 100%;
        height: 100%;
        dialog_height: 180px;
        title_text: AppI18n.t("dialog.delete_title", [AppI18n.version]);
        message: AppI18n.t("dialog.delete_msg", [delete_target_name, AppI18n.version]);
        confirm => {
            root.confirm_delete();
        }
        cancel => {
            root.cancel_delete();
        }
    }
    if (show_export): ExportDialog {
        width: 100%;
        height: 100%;
        distro_name: export_target_name;
        export_path <=> root.export_path;
        error_msg: export_error;
        enabled: !root.is_installing;
        cancel => {
            root.cancel_export();
        }
        browse => {
            root.browse_export();
        }
        confirm(path) => {
            root.confirm_export(path);
        }
    }
    if (show_clone): CloneDialog {
        width: 100%;
        height: 100%;
        distro_name: clone_source_name;
        clone_name <=> root.clone_target_name;
        clone_path <=> root.clone_target_path;
        error_msg: clone_error;
        enabled: !root.is_installing;
        cancel => {
            root.cancel_clone();
        }
        browse => {
            root.browse_clone();
        }
        name_changed(text) => {
            root.clone_name_changed(text);
        }
        confirm(name, path) => {
            root.confirm_clone(name, path);
        }
    }
    if (show_move): MoveDialog {
        width: 100%;
        height: 100%;
        distro_name: move_source_name;
        move_path <=> root.move_target_path;
        error_msg: move_error;
        enabled: !root.is_installing;
        cancel => {
            root.cancel_move();
        }
        browse => {
            root.browse_move();
        }
        confirm(path) => {
            root.confirm_move(path);
        }
    }
    if (show_move_confirm): ConfirmationDialog {
        width: 100%;
        height: 100%;
        dialog_height: 250px;
        title_text: AppI18n.t("dialog.move_title", []);
        message: root.move_confirm_message;
        confirm => {
            root.confirm_move_action();
        }
        cancel => {
            root.cancel_move_confirm();
        }
    }
    if (show_message): Rectangle {
        width: 100%;
        height: 100%;
        background: #00000080;
        TouchArea { /* prevent interaction with elements behind */ }

        MessageDialog {
            message: root.message_text;
            link_text: root.message_link_text;
            action_text: root.message_action_text;
            close => {
                root.close_message();
            }
            link_clicked => {
                root.message_link_clicked();
            }
            action_clicked => {
                root.message_action_clicked();
            }
        }
    }
    if (show_update): CheckUpdateDialog {
        width: 100%;
        height: 100%;
        message_content: AppI18n.t("dialog.update_msg", [AppInfo.latest_version, AppInfo.version, AppI18n.version]);
        is_expire: false;
        show_cancel: true;
        download => {
            root.download_update();
        }
        close => {
            root.close_update();
        }
    }
    if (show_install_warn): StoreInstallWarnDialog {
        width: 100%;
        height: 100%;
        confirm => {
            root.confirm_install_warn();
        }
        cancel => {
            root.cancel_install_warn();
        }
    }
    if (show_expire): CheckUpdateDialog {
        width: 100%;
        height: 100%;
        message_content: AppI18n.t("dialog.expire_msg", [AppI18n.version]);
        is_expire: true;
        show_cancel: true;
        download => {
            root.download_update();
        }
        close => {
            root.close_expire();
        }
    }
    if (show_information): InformationDialog {
        width: 100%;
        height: 100%;
        info: information;
        close => {
            root.close_information();
        }
        open_path(url) => {
            root.open_url(url);
        }
    }
    if (show_settings): SettingsDialog {
        width: 100%;
        height: 100%;
        distro_name: settings_target_name;
        terminal_dir <=> settings_terminal_dir;
        vscode_dir <=> settings_vscode_dir;
        is_default <=> settings_is_default;
        lock_default: settings_lock_default;
        autostart <=> settings_autostart;
        startup_script <=> settings_startup_script;
        terminal_dir_error: settings_terminal_dir_error;
        vscode_dir_error: settings_vscode_dir_error;
        startup_script_error: settings_startup_script_error;
        default_error: settings_default_error;
        save => {
            root.confirm_settings(root.settings_target_name, root.settings_terminal_dir, root.settings_vscode_dir, root.settings_is_default, root.settings_autostart, root.settings_startup_script);
        }
        close => {
            root.close_settings();
        }
    }
    if (show_rootfs_help): RootFSHelpDialog {
        width: 100%;
        height: 100%;
        help_list: root.rootfs_help_list;
        close => {
            root.close_rootfs_help();
        }
        open_url(url) => {
            root.open_url(url);
        }
    }
    if (show_vscode_startup): VSCodeStartupDialog {
        width: 100%;
        height: 100%;
        close => {
            root.close_vscode_startup();
        }
    }
}
