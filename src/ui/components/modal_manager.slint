import {
    ConfirmationDialog,
    ExportDialog,
    CloneDialog,
    MessageDialog,
    CheckUpdateDialog,
    StoreInstallWarnDialog,
    InformationDialog,
    OperationOverlay,
    RootFSHelpDialog,
    VSCodeStartupDialog,
} from "dialogs.slint";
import { AppInfo, Information, RootFSHelpItem, AppI18n } from "../theme.slint";

export component ModalManager inherits Rectangle {
    // Controls
    in property <bool> show_delete: false;
    in property <bool> show_export: false;
    in property <bool> show_clone: false;
    in property <bool> show_message: false;
    in property <bool> show_update: false;
    in property <bool> show_install_warn: false;
    in property <bool> show_expire: false;
    in property <bool> show_operation: false;
    in property <bool> show_information: false;
    in property <bool> show_rootfs_help: false;
    in property <bool> show_vscode_startup: false;
    in property <bool> is_installing: false;

    // Data
    in property <string> delete_target_name: "";
    in property <string> export_target_name: "";
    in-out property <string> export_path;
    in property <string> export_error: "";
    in property <string> clone_source_name: "";
    in-out property <string> clone_target_name;
    in-out property <string> clone_target_path;
    in property <string> clone_error: "";
    in property <string> message_text;
    in property <string> operation_text: "Processing...";
    in property <Information> information;
    in property <[RootFSHelpItem]> rootfs_help_list;

    // Callbacks
    callback confirm_delete();
    callback cancel_delete();
    callback confirm_export(string);
    callback cancel_export();
    callback browse_export();
    callback confirm_clone(string, string);
    callback cancel_clone();
    callback browse_clone();
    callback close_message();
    callback clone_name_changed(string);
    callback download_update();
    callback close_update();
    callback confirm_install_warn();
    callback cancel_install_warn();
    callback close_expire();
    callback close_operation();
    callback close_information();
    callback close_rootfs_help();
    callback close_vscode_startup();
    callback open_url(string);
    if (show_delete): ConfirmationDialog {
        width: 100%;
        height: 100%;
        title_text: AppI18n.t("dialog.delete_title", [AppI18n.version]);
        message: AppI18n.t("dialog.delete_msg", [delete_target_name, AppI18n.version]);
        confirm => {
            root.confirm_delete();
        }
        cancel => {
            root.cancel_delete();
        }
    }
    if (show_export): ExportDialog {
        width: 100%;
        height: 100%;
        distro_name: export_target_name;
        export_path <=> root.export_path;
        error_msg: export_error;
        enabled: !root.is_installing;
        cancel => {
            root.cancel_export();
        }
        browse => {
            root.browse_export();
        }
        confirm(path) => {
            root.confirm_export(path);
        }
    }
    if (show_clone): CloneDialog {
        width: 100%;
        height: 100%;
        distro_name: clone_source_name;
        clone_name <=> root.clone_target_name;
        clone_path <=> root.clone_target_path;
        error_msg: clone_error;
        enabled: !root.is_installing;
        cancel => {
            root.cancel_clone();
        }
        browse => {
            root.browse_clone();
        }
        name_changed(text) => {
            root.clone_name_changed(text);
        }
        confirm(name, path) => {
            root.confirm_clone(name, path);
        }
    }
    if (show_message): MessageDialog {
        width: 100%;
        height: 100%;
        message: root.message_text;
        close => {
            root.close_message();
        }
    }
    if (show_update): CheckUpdateDialog {
        width: 100%;
        height: 100%;
        message_content: AppI18n.t("dialog.update_msg", [AppInfo.latest_version, AppInfo.version, AppI18n.version]);
        is_expire: false;
        show_cancel: true;
        download => {
            root.download_update();
        }
        close => {
            root.close_update();
        }
    }
    if (show_install_warn): StoreInstallWarnDialog {
        width: 100%;
        height: 100%;
        confirm => {
            root.confirm_install_warn();
        }
        cancel => {
            root.cancel_install_warn();
        }
    }
    if (show_expire): CheckUpdateDialog {
        width: 100%;
        height: 100%;
        message_content: AppI18n.t("dialog.expire_msg", [AppI18n.version]);
        is_expire: true;
        show_cancel: true;
        download => {
            root.download_update();
        }
        close => {
            root.close_expire();
        }
    }
    if (show_operation): OperationOverlay {
        width: 100%;
        height: 100%;
        message: operation_text;
        clicked => {
            root.close_operation();
        }
    }
    if (show_information): InformationDialog {
        width: 100%;
        height: 100%;
        info: information;
        close => {
            root.close_information();
        }
        open_path(url) => {
            root.open_url(url);
        }
    }
    if (show_rootfs_help): RootFSHelpDialog {
        width: 100%;
        height: 100%;
        help_list: root.rootfs_help_list;
        close => {
            root.close_rootfs_help();
        }
        open_url(url) => {
            root.open_url(url);
        }
    }
    if (show_vscode_startup): VSCodeStartupDialog {
        width: 100%;
        height: 100%;
        close => {
            root.close_vscode_startup();
        }
    }
}
